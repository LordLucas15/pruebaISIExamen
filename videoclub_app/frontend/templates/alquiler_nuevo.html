{% extends "base.html" %}
{% block title %}Nuevo alquiler · Videoclub{% endblock %}
{% block content %}
  <h2>Registrar alquiler</h2>
  <form method="post" class="card">
    <div class="grid-2">
      <label>Fecha recogida <input type="date" name="fecha_recogida" required></label>
      <label>Fecha devolución <input type="date" name="fecha_devolucion" required></label>
      <label>Socio
        <select name="socio_id" required>
          <option value="">— Selecciona —</option>
          {% for s in socios %}
            <option value="{{ s.id }}">{{ s.nombre }}</option>
          {% endfor %}
        </select>
      </label>
      <label>Películas (Ctrl/Cmd para multi-selección)
        <select name="peliculas_ids" multiple size="6" required>
          {% for p in peliculas %}
            <option value="{{ p.id }}">{{ p.nombre }}</option>
          {% endfor %}
        </select>
      </label>
    </div>
    <button class="btn btn-sm" type="submit">Crear alquiler</button>
  </form>

  <h3>Alquileres registrados</h3>
  <form method="get" class="card">
    <label>
      Buscar alquiler por ID o socio
      <input type="text" name="q" value="{{ q or '' }}" placeholder="Ej. 10 o Laura">
    </label>
    <button class="btn btn-sm" type="submit">Buscar</button>
  </form>

  <table>
    <thead>
      <tr><th>ID</th><th>Socio</th><th>Recogida</th><th>Devolución</th><th>Nº películas</th></tr>
    </thead>
    <tbody>
      {% for a in alquileres %}
        <tr>
          <td>{{ a.id }}</td>
          <td>{{ a.socio_nombre }}</td>
          <td>{{ a.fecha_recogida }}</td>
          <td>{{ a.fecha_devolucion }}</td>
          <td>{{ a.num_peliculas }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if total_pages > 1 %}
    <nav class="pager" aria-label="Paginación de alquileres">
      {% if page > 1 %}
        <a href="{{ url_for('alquiler_nuevo', page=page-1, q=q) }}">« Anterior</a>
      {% endif %}
      <span>Página {{ page }} de {{ total_pages }}</span>
      {% if page < total_pages %}
        <a href="{{ url_for('alquiler_nuevo', page=page+1, q=q) }}">Siguiente »</a>
      {% endif %}
    </nav>
  {% endif %}
{% endblock %}
